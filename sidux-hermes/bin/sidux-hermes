#!/bin/bash
# sidux-hermes
# Copyright (c) 2007 Fabian Wuertz
# License GPL 2


#------------------------------------------------------------------------------#
#--- sidux warnings & news ----------------------------------------------------#
#------------------------------------------------------------------------------#

function duWarnings()
{
	TMP="$(mktemp -p /tmp/ du-warning-XXXXXXXXXX)"
	wget -O $TMP -q -U "siduxcc-hermes" http://sidux.com/xBackends.php
	tmp=`cat $TMP`
	if [ -n "$tmp" ]; then 
		egrep title $TMP | grep WARNING | cut -f2 -d"<" | cut -c7-
		egrep title $TMP | grep Warning | cut -f2 -d"<" | cut -c7-
	else
		echo "disconnected"
	fi
	rm -f $TMP
}

function duWarningsEn()
{
	TMP="$(mktemp -p /tmp/ du-warning-XXXXXXXXXX)"
	wget -O $TMP -q -U "siduxcc-hermes" http://sidux.com/backend.php
	grep -A 1 Warning $TMP
	rm -f $TMP
}

function duWarningsDe()
{
	TMP="$(mktemp -p /tmp/ du-warning-XXXXXXXXXX)"
	wget -O $TMP -q -U "siduxcc-hermes" http://sidux.com/backend.php?newlang=deu
	grep -A 1 Warnung $TMP
	rm -f $TMP
}

function getNewsEn()
{
	TMP="$(mktemp -p /tmp/ sidux-news-XXXXXXXXXX)"
	wget -O $TMP -q -U "siduxcc-hermes" http://sidux.com/backend.php
	grep -A 1 title $TMP | grep -B 1 link
	rm -f $TMP
}

function getNewsDe()
{
	TMP="$(mktemp -p /tmp/ sidux-news-XXXXXXXXXX)"
	wget -O $TMP -q -U "siduxcc-hermes" http://sidux.com/backend.php?newlang=deu
	grep -A 1 title $TMP | grep -B 1 link
	rm -f $TMP
} 

#------------------------------------------------------------------------------#
#--- kernel functions ---------------------------------------------------------#
#------------------------------------------------------------------------------#

function kernelType()
{
	if [ -n "$(uname -r | grep 686)" ]; then
		echo 686
	elif [ -n "$(uname -r | grep amd64)" ]; then
		echo amd64
	fi
}

function currentKernel()
{
	uname -r
}

function newestKernel()
{
	wget -U "siduxcc-hermes" -O - http://sidux.com/debian/pool/main/l/linux-sidux-2.6/ 2>/dev/null | grep linux-image | grep $(kernelType) | tail -n 1 | cut -f8 -d\" | cut -f1 -d_ | cut -f3- -d-
}


#------------------------------------------------------------------------------#
#--- start app ----------------------------------------------------------------#
#------------------------------------------------------------------------------#

case $1 in
	"duWarnings"       ) duWarnings;;
	"duWarningsEn"     ) duWarningsEn;;
	"duWarningsDe"     ) duWarningsDe;;
	"getNewsEn"        ) getNewsEn;;
	"getNewsDe"        ) getNewsDe;;
	"currentKernel"    ) currentKernel;;
	"newestKernel"     ) newestKernel;;
esac